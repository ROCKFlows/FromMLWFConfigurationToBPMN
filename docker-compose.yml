version: "3.9"  # optional since v1.27.0
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - ARANGO_URL=arango:8529
      - NEO4J_URL=neo4j:7474
      - SPRING_PROFILE=neo4j
    ports:
      - "8080:8080"
    entrypoint: "sh -c '/ml2wf-runner/wait-for-them.sh $${ARANGO_URL} $${NEO4J_URL} -- java -jar -Dspring.profiles.active=$${SPRING_PROFILE} /ml2wf-runner/ml2wf.jar'"
    depends_on:
      - arango
      - neo4j
  frontend:
    build:
      context: ./frontend/
      dockerfile: Dockerfile
    ports:
      - "4173:4173"
    depends_on:
      - app
  arango:
    image: arangodb:3.9.0
    ports:
      - "8529:8529"
    # TODO: volumes:
    environment:
      - ARANGO_ROOT_USER=ml2wf_user
      - ARANGO_ROOT_PASSWORD=ml2wf_password
  neo4j:
    image: neo4j:4.4.8
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_AUTH=neo4j/ml2wf_password

